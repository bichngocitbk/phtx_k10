<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√°n C·ªï ‚Äî H·ªçc T·ª´ V·ª±ng</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../style_learn_vocab.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+XiaoWei&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<a href="../" class="home-btn">üè† Home</a>
<button class="toggle-btn btn-shuffle" onclick="shuffleAndRender()">üîÄ X√°o tr·ªôn</button>
<div class="container">
    <!-- HEADER -->
    <div class="header">
        <h1>Â≠∏ Ë©û ÂΩô</h1>
        <div class="subtitle">H·ªçc T·ª´ V·ª±ng H√°n C·ªï</div>
    </div>

    <!-- CONTROLS -->
    <div class="nav-buttons">
        <a href="hanco03_vocab_learn01.html" class="nav-btn-collect">B·ªô 1</a>
        <a href="hanco03_vocab_learn02.html" class="nav-btn-collect">B·ªô 2</a>
        <a href="hanco03_vocab_learn03.html" class="nav-btn-collect">B·ªô 3</a>
        <a href="hanco03_vocab_learn04.html" class="nav-btn-collect">B·ªô 4</a>
        <a href="hanco03_vocab_learn05.html" class="nav-btn-collect">B·ªô 5</a>
        <a href="hanco03_vocab_learn06.html" class="nav-btn-collect">B·ªô 6</a>
        <a href="hanco03_vocab_learn07.html" class="nav-btn-collect">B·ªô 7</a>
        <a href="hanco03_vocab_learn08.html" class="nav-btn-collect">B·ªô 8</a>
        <span class="stats-badge" id="statsBadge">ƒêang t·∫£i...</span>
    </div>
    

    <!-- COLUMN HEADERS -->
    <div class="col-headers" id="colHeaders"></div>

    <!-- VOCAB GRID -->
    <div class="vocab-grid" id="vocabGrid">
        <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <div>ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets...</div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer-note">
        Click v√†o √¥ H√°n Vi·ªát ƒë·ªÉ ·∫©n/hi·ªán ‚Ä¢ Nh·∫•n <strong>·∫®n t·∫•t c·∫£</strong> ƒë·ªÉ b·∫Øt ƒë·∫ßu t·ª± ki·ªÉm tra
    </div>
</div>
<button class="toggle-btn hide-all-btn" onclick="hideAll()">üôà Hide All</button>
<button class="toggle-btn show-all-btn" onclick="revealAll()">üëÅÔ∏è Show All</button>
    
<script>
    // ============================================================
    // C·∫§U H√åNH ‚Äî Thay ƒë·ªïi c√°c gi√° tr·ªã XXX b√™n d∆∞·ªõi
    // ============================================================
    const SPREADSHEET_ID = "1eO-Wwh0RG9qgSBFJZx6CB_6Vl44PAlApk-DB6VFzthw";
    const API_KEY = "AIzaSyATK07C-sbdWh3dt9KvsAKRv2jut0CAgCY";
    const SHEET_NAME = "GK3002";

    const range = `${SHEET_NAME}!B1:C`;
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;

    // ============================================================
    // STATE
    // ============================================================
    let allData = [];       // [{han, hv}, ...]
    let displayData = [];   // shuffled copy
    const NUM_COLS = 3;     // 3 pairs of columns

    // ============================================================
    // FETCH DATA
    // ============================================================
    async function fetchData() {
        try {
            const resp = await fetch(url);
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const json = await resp.json();
            const rows = json.values || [];

            allData = rows
                .filter(r => r[0] && r[1])
                .map(r => ({ han: r[0].trim(), hv: r[1].trim() }));

            if (allData.length === 0) throw new Error("Kh√¥ng c√≥ d·ªØ li·ªáu");

            displayData = [...allData];
            render();
            updateStats();
        } catch (err) {
            document.getElementById('vocabGrid').innerHTML =
                `<div class="error-state" style="grid-column:1/-1;">
                    <strong>‚ö† L·ªói t·∫£i d·ªØ li·ªáu</strong><br>
                    ${err.message}<br><br>
                    <small>Ki·ªÉm tra SPREADSHEET_ID, API_KEY, SHEET_NAME trong m√£ ngu·ªìn.</small>
                </div>`;
        }
    }

    // ============================================================
    // RENDER
    // ============================================================
    function render() {
        const headerEl = document.getElementById('colHeaders');
        const gridEl = document.getElementById('vocabGrid');

        // Build headers
        let headersHTML = '';
        for (let c = 0; c < NUM_COLS; c++) {
            headersHTML += `
                <div class="col-pair-header">
                    <span>Êº¢Â≠ó</span>
                    <span>H√°n Vi·ªát</span>
                </div>`;
        }
        headerEl.innerHTML = headersHTML;

        // Split data into columns
        const totalRows = displayData.length;
        const rowsPerCol = Math.ceil(totalRows / NUM_COLS);

        const columns = [];
        for (let c = 0; c < NUM_COLS; c++) {
            const start = c * rowsPerCol;
            const end = Math.min(start + rowsPerCol, totalRows);
            columns.push(displayData.slice(start, end));
        }

        // Build grid
        let gridHTML = '';
        for (let c = 0; c < NUM_COLS; c++) {
            gridHTML += '<div class="vocab-column">';
            const colData = columns[c] || [];
            colData.forEach((item, i) => {
                const globalIdx = c * rowsPerCol + i + 1;
                gridHTML += `
                    <div class="vocab-row" id="row-${globalIdx}">
                        <div class="cell-han">
                            <span class="row-idx">${globalIdx}</span>${item.han}
                        </div>
                        <div class="cell-hv hidden"
                             onclick="toggleCell(this)"
                             data-text="${escapeAttr(item.hv)}">
                            ${item.hv}
                        </div>
                    </div>`;
            });
            gridHTML += '</div>';
        }

        gridEl.innerHTML = gridHTML;
    }

    // ============================================================
    // INTERACTIONS
    // ============================================================
    function toggleCell(el) {
        el.classList.toggle('hidden');
        el.classList.toggle('revealed');
        updateStats();
    }

    function revealAll() {
        document.querySelectorAll('.cell-hv').forEach(el => {
            el.classList.remove('hidden');
            el.classList.add('revealed');
        });
        updateStats();
    }

    function hideAll() {
        document.querySelectorAll('.cell-hv').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('revealed');
        });
        updateStats();
    }

    function shuffleAndRender() {
        displayData = [...allData];
        // Fisher-Yates shuffle
        for (let i = displayData.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [displayData[i], displayData[j]] = [displayData[j], displayData[i]];
        }
        render();
        updateStats();
    }

    function updateStats() {
        const total = document.querySelectorAll('.cell-hv').length;
        const revealed = document.querySelectorAll('.cell-hv.revealed').length;
        const hidden = total - revealed;
        document.getElementById('statsBadge').innerHTML =
            `T·ªïng: <strong>${total}</strong> &nbsp;|&nbsp; ƒê√£ hi·ªán: <strong>${revealed}</strong> &nbsp;|&nbsp; ƒêang ·∫©n: <strong>${hidden}</strong>`;
    }

    // ============================================================
    // UTILS
    // ============================================================
    function escapeAttr(str) {
        return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    // ============================================================
    // INIT
    // ============================================================
    fetchData();
</script>

</body>
</html>
